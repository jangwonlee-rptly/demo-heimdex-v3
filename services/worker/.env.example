# Heimdex Worker Service - Environment Configuration Example

# Supabase Configuration
HEIMDEX_SUPABASE_URL=https://your-project.supabase.co
HEIMDEX_SUPABASE_SERVICE_ROLE_KEY=your-service-role-key

# Database Configuration
HEIMDEX_DATABASE_URL=postgresql://user:password@host:5432/database

# Redis Configuration
HEIMDEX_REDIS_URL=redis://redis:6379/0

# OpenAI Configuration
HEIMDEX_OPENAI_API_KEY=sk-your-openai-api-key

# Processing Configuration
HEIMDEX_TEMP_DIR=/tmp/heimdex
HEIMDEX_MAX_KEYFRAMES_PER_SCENE=3
HEIMDEX_EMBEDDING_MODEL=text-embedding-3-small
HEIMDEX_EMBEDDING_DIMENSIONS=1536

# ============================================================================
# Scene Detection Configuration
# ============================================================================

# Scene detection strategy: "adaptive" (recommended) or "content"
HEIMDEX_SCENE_DETECTOR=adaptive

# Minimum scene length in seconds (prevents micro-scenes)
HEIMDEX_SCENE_MIN_LEN_SECONDS=1.0

# --- AdaptiveDetector Settings (used when SCENE_DETECTOR=adaptive) ---
# Adaptive threshold: Lower = more sensitive, more scenes detected
# Recommended range: 2.0 - 5.0
HEIMDEX_SCENE_ADAPTIVE_THRESHOLD=3.0

# Window width for rolling average: 1-4
# Larger = smoother detection, smaller = more responsive
HEIMDEX_SCENE_ADAPTIVE_WINDOW_WIDTH=2

# Minimum content value to trigger scene detection
# Recommended range: 10.0 - 20.0
HEIMDEX_SCENE_ADAPTIVE_MIN_CONTENT_VAL=15.0

# --- ContentDetector Settings (used when SCENE_DETECTOR=content) ---
# Content threshold: Lower = more sensitive, more scenes detected
# PySceneDetect default is 27.0
HEIMDEX_SCENE_CONTENT_THRESHOLD=27.0

# ============================================================================
# Parallel Processing Configuration
# ============================================================================

# Max concurrent scenes to process in parallel
HEIMDEX_MAX_SCENE_WORKERS=3

# Max concurrent API calls (respects rate limits)
HEIMDEX_MAX_API_CONCURRENCY=3

# ============================================================================
# Visual Semantics Optimization Configuration
# ============================================================================

# Enable/disable visual semantics processing entirely
HEIMDEX_VISUAL_SEMANTICS_ENABLED=true

# OpenAI model for visual analysis (gpt-4o-mini is cheaper)
HEIMDEX_VISUAL_SEMANTICS_MODEL=gpt-4o-mini

# Max tokens for visual analysis response
HEIMDEX_VISUAL_SEMANTICS_MAX_TOKENS=128

# Temperature for visual analysis (0 = deterministic)
HEIMDEX_VISUAL_SEMANTICS_TEMPERATURE=0.0

# Include entities and actions in JSON response
HEIMDEX_VISUAL_SEMANTICS_INCLUDE_ENTITIES=true
HEIMDEX_VISUAL_SEMANTICS_INCLUDE_ACTIONS=true

# Frame quality thresholds for pre-filtering
# Brightness threshold: 0-255 (lower = darker frames skipped)
HEIMDEX_VISUAL_BRIGHTNESS_THRESHOLD=15.0

# Blur threshold: Laplacian variance (higher = only sharp frames)
HEIMDEX_VISUAL_BLUR_THRESHOLD=100.0
